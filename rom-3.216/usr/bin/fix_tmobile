#!/bin/sh

operator=`gl_modem -B $bus AT AT+COPS? | grep COPS | cut -d '"' -f 2`
[ -n "$operator" -a "$operator" = "T-Mobile" ] && {
    pdp=`gl_modem -B $bus AT 'AT$QCPRFMOD=PID:1' | grep OVRRIDEHOPDP | cut -d '"' -f 2`
    [ ! "$pdp" = "IPV4V6" ] && gl_modem -B $bus AT 'AT$QCPRFMOD=PID:1,OVRRIDEHOPDP:"IPV4V6"'
    exit
}

cimi=$(gl_modem -B $bus AT 'AT+CIMI' | tr -cd "[0-9]")
mcc=${cimi:0:3}
mnc=${cimi:3:3}

[ "$mcc" = "310" ] || exit
[ "$mnc" = "210" -o "$mnc" = "260" -o "$mnc" = "200" -o "$mnc" = "250" -o "$mnc" = "160" -o "$mnc" = "240" -o "$mnc" = "660" -o "$mnc" = "230" -o "$mnc" = "220" -o "$mnc" = "270" -o "$mnc" = "300" -o "$mnc" = "280" -o "$mnc" = "330" -o "$mnc" = "800" -o "$mnc" = "310" ] || exit
pdp=`gl_modem -B $bus AT 'AT$QCPRFMOD=PID:1' | grep OVRRIDEHOPDP | cut -d '"' -f 2`
[ ! "$pdp" = "IPV4V6" ] && gl_modem -B $bus AT 'AT$QCPRFMOD=PID:1,OVRRIDEHOPDP:"IPV4V6"'