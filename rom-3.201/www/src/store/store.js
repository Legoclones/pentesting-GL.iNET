"use strict";define(["vue","vueX","store/api","apn","store/mock","jquery","language","promise","Cookie","component/gl-message/index"],function(Vue,Vuex,api,apnlist,mock,jquery,language,Promise,Cookies,message){var apiItem={};Vue.prototype.$lang=language;var mode="develop";if(window.location.href.indexOf("chrome-extension")==-1){mode="product"}var ip="192.168.113.210";ip="192.168.8.1";var host="http://"+ip;if(Object.keys){Object.keys(api).map(function(item){apiItem[item]={}})}else{for(var key in api){apiItem[key]={}}}Array.prototype.remove=function(val){var index=this.indexOf(val);if(index>-1){this.splice(index,1)}};var state={apiData:apiItem,timer_repeater:"",timer_vpn:"",vpnData:[],carinfo:[],allsorft:[],onlist:[],offlist:["waninfo","repeater","tethering","modem"],lang:"",packageList:[],animation:["zoom","fade","flip","door","rotate","slideUp","slideDown","slideLeft","slideRight"],modal:{show:false,animation:"",cb:null,cancel:null,esc:true,title:"",message:"",yes:"",no:"",type:"",messageTwo:"",messageThree:"",showCancelBtn:true,closeOnClickMask:true},inetrStatus:true,loading:false};var getters={packageList:function packageList(state){return state.packageList},apiData:function apiData(state){return state.apiData},vpnData:function vpnData(state){return state.vpnData},onlist:function onlist(state){return state.onlist},offlist:function offlist(state){return state.offlist},carinfo:function carinfo(state){return state.carinfo},allsorft:function allsorft(state){return state.allsorft},inetr_status:function inetr_status(state){return state.inetrStatus},isLoading:function isLoading(state){return state.loading},modal:function modal(state){return state.modal},lang:function lang(state){return state.lang}};function getStainfo(state,dispatch,commit){clearTimeout(state.timer_repeater);state.timer_repeater=setTimeout(function(){if(state.apiData["stainfo"].code!=-17)dispatch("call",{api:"stainfo"}).then(function(result){if(result.success){if(result.ip){commit("setonlist",{data:"repeater"})}else{commit("setofflist",{data:"repeater"})}}else{commit("setofflist",{data:"repeater"})}getStainfo(state,dispatch,commit)}).catch(function(){getStainfo(state,dispatch,commit)})},1e4)}var actions={call:function call(_ref,payload){var state=_ref.state,commit=_ref.commit,datacache=false;var promise=new Promise(function(resolve){var currentdate=(new Date).getTime();if(payload.data){if(payload.cache){datacache=true}}else{if(payload.sync){datacache=false}else{datacache=true}}var TokenKey="Admin-Token";var token=Cookies.get(TokenKey);var hostip=payload.ip;if(!payload.isModel){var SyncTime=parseInt(currentdate-state.apiData[payload.api]["lastSync"])}if(!SyncTime){SyncTime=0}if(datacache&&!payload.isModel&&state.apiData[payload.api]["lastSync"]&&SyncTime<3e3&&payload.api.indexOf("status")!=-1){resolve(state.apiData[payload.api])}else{commit("setSyncTime",{api:payload.api,lastSync:currentdate,isModel:payload.isModel});var contentType=payload.contentType;var processData=payload.processData;if(Object.prototype.toString.call(payload.data).split(" ")[1].split("]")[0]=="FormData"){contentType=false;processData=false}if(!hostip){hostip=mode=="develop"?payload.isModel?payload.api:host+api[payload.api]:payload.isModel?payload.api:api[payload.api]}else{hostip="http://"+payload.ip+api[payload.api]}if(payload.mock){var mockData={};if(payload.mock=="error"){mockData.api=payload.api;mockData.failed=true;mockData.unsuccess=true;mockData.errMsg="not data";commit("setApiData",mockData);resolve(state.apiData[payload.api])}else{mockData=mock[payload.api];mockData.api=payload.api;if(mock[payload.api].code==0){mockData.success=true}else{mockData.success=false}commit("setApiData",mockData);resolve(state.apiData[payload.api])}}else{jquery.ajax({url:hostip,data:payload.data,type:payload.data==null?"get":"post",cache:false,dataType:payload.dataType==null?"json":payload.dataType,beforeSend:function beforeSend(request){request.setRequestHeader("Authorization",token)},contentType:contentType,processData:processData,timeout:payload.timeOut==null?2e4:payload.timeOut,success:function success(result){if(payload.api!="internetreachable"){if(result.code==-1){Cookies.remove("Admin-Token");location.reload(true)}}result.api=payload.api;result.lastSync=(new Date).getTime();commit("setApiData",result);if(result.code==0){result.success=true}else{result.success=false}resolve(result)},error:function error(XMLHttpRequest,textStatus,errorThrown){var result={};if(textStatus=="timeout"){result.timeout=true;result.code=-6;state.apiData[payload.api].code=-6}result.api=payload.api;result.success=false;result.failed=true;resolve(result)}})}}});return promise},getWifi:function getWifi(_ref2){var state=_ref2.state,commit=_ref2.commit;var promise=new Promise(function(resolve){commit("sortWifi");commit("filterWifi");resolve(state.apiData["scanwifi"])});return promise},getList_vpn:function getList_vpn(_ref2){var state=_ref2.state,commit=_ref2.commit,dispatch=_ref2.dispatch;var that=this;dispatch("call",{api:"getapplist"}).then(function(result){if(result.success){if(result.applist){var vpnList=[];var ui_package=[];for(var i=0;i<result.applist.length;i++){if(result.applist[i].indexOf("OpenVPN")!=-1||result.applist[i].indexOf("WireGuard")!=-1||result.applist[i].indexOf("Shadowsocks")!=-1){switch(result.applist[i]){case"OpenVPN-Client":vpnList.push({router:"vpnclient",name:"OpenVPN Client",api:"ovpngetclientstatus"});break;case"OpenVPN-Server":vpnList.push({router:"vpnserver",name:"OpenVPN Server"});break;case"Shadowsocks-Client":vpnList.push({router:"ssclient",name:"SS Client",api:"ssclientstatus"});break;case"Shadowsocks-Server":vpnList.push({router:"ssserver",name:"SS Server"});break;case"WireGuard-Client":vpnList.push({router:"wgclient",name:"WireGuard Client",api:"wgcstatus"});break;case"WireGuard-Server":vpnList.push({router:"wgserver",name:"WireGuard Server"});break}}else{ui_package.push(result.applist[i])}}commit("getData_vpn",vpnList);commit("getPackage",ui_package)}}})},getInfo_repeater:function getInfo_repeater(_ref2){var state=_ref2.state,dispatch=_ref2.dispatch,commit=_ref2.commit;dispatch("call",{api:"stainfo"}).then(function(result){if(result.success){if(result.ip){commit("setonlist",{data:"repeater"})}else{commit("setofflist",{data:"repeater"})}}else{commit("setofflist",{data:"repeater"})}});getStainfo(state,dispatch,commit)}};var mutations={getPackage:function getPackage(state,payload){var newRouter=[];for(var i=0;i<payload.length;i++){var routerObj={};var payloadList=payload[i].split(",");routerObj.router=payloadList[0];routerObj.name=payloadList[1];newRouter.push(routerObj)}state.packageList=newRouter},clearTimer_sta:function clearTimer_sta(state){clearTimeout(state.timer_repeater)},isInit:function isInit(state,payload){state.loading=payload},isGetStatus_inter:function isGetStatus_inter(state,payload){state.inetrStatus=payload},getData_vpn:function getData_vpn(state,payload){state.vpnData=payload},setApiData:function setApiData(state,payload){state.apiData[payload.api]=payload},setSyncTime:function setSyncTime(state,payload){if(!payload.isModel){state.apiData[payload.api]["lastSync"]=payload.lastSync}},setAllSorft:function setAllSorft(state,payload){state.allsorft=payload},setLang:function setLang(state,payload){state.lang=payload.lang},sortWifi:function sortWifi(state){var encryptWifi=state.apiData["scanwifi"]["wifis"].filter(function(item){return item.type!="normal"});var wifi_dfs=state.apiData["scanwifi"]["wifis"].filter(function(item){return item.type!="dfs"});encryptWifi.sort(function(a,b){return b.signal-a.signal});wifi_dfs.sort(function(a,b){return b.signal-a.signal});state.apiData["scanwifi"]["wifis"]=wifi_dfs.concat(encryptWifi)},filterWifi:function filterWifi(state){var wifilist=state.apiData["scanwifi"]["wifis"];var encryptList2g={};var unEncrypt2g={};var encryptList={};var unEncrypt={};state.apiData["scanwifi"]["wifis"]=wifilist.reduce(function(cur,next){if(next.channel>=36){if(next.encrypt=="none"){unEncrypt2g[next.ssid]?"":unEncrypt2g[next.ssid]=true&&cur.push(next)}else{encryptList2g[next.ssid]?"":encryptList2g[next.ssid]=true&&cur.push(next)}}else{if(next.encrypt=="none"){unEncrypt[next.ssid]?"":unEncrypt[next.ssid]=true&&cur.push(next)}else{encryptList[next.ssid]?"":encryptList[next.ssid]=true&&cur.push(next)}}return cur},[])},setonlist:function setonlist(state,payload){if(state.onlist.indexOf(payload.data)<0){state.onlist.unshift(payload.data);state.offlist.remove(payload.data);$("html,body").animate({scrollTop:0},500)}},setofflist:function setofflist(state,payload){if(state.offlist.indexOf(payload.data)<0){state.offlist.push(payload.data);state.onlist.remove(payload.data)}if(state.offlist.length==4){state.offlist=["waninfo","repeater","tethering","modem"]}},removeInter:function removeInter(state,payload){state.offlist.remove(payload.data);state.onlist.remove(payload.data)},getapns:function getapns(state,payload){var mcc=payload.mcc||"000";var mnc=payload.mnc||"000";var carrial=apnlist.apns.apn.filter(function(val){return val["-mcc"]==mcc});var carinfo=carrial.filter(function(val){return val["-mnc"]==mnc});if(!carinfo.length){var mncData=mnc.substr(0,2);carinfo=carrial.filter(function(val){return val["-mnc"]==mncData})}if(state.carinfo.length<=3){state.carinfo.push(carinfo)}},checkapns:function checkapns(state){state.carinfo=[]},changeVal:function changeVal(state,payload){payload.data[payload.attr]=payload.val},showModal:function showModal(state,payload){state.modal.show=payload.show?payload.show:true;state.modal.animation=payload.animation?payload.animation:state.animation[parseInt(Math.random()*10)];state.modal.title=payload.title?payload.title:"Caution";state.modal.yes=payload.yes?payload.yes:"Yes";state.modal.no=payload.no?payload.no:"No";state.modal.showCancelBtn=payload.showCancelBtn==false?payload.showCancelBtn:true;state.modal.type=payload.type?payload.type:"default";state.modal.message=payload.message?payload.message:"message";state.modal.href=payload.href?payload.href:"";state.modal.messageTwo=payload.messageTwo?payload.messageTwo:"";state.modal.href=payload.href?payload.href:"";state.modal.messageTwoi=payload.messageTwoi?payload.messageTwoi:"";state.modal.messageTwos=payload.messageTwos?payload.messageTwos:"";state.modal.messageThree=payload.messageThree?payload.messageThree:"";state.modal.esc=payload.esc;state.modal.closeOnClickMask=payload.closeOnClickMask;state.modal.cb=payload.cb?payload.cb:null;state.modal.cancel=payload.cancel?payload.cancel:null;state.modal.showfoot=payload.showfoot==0?payload.showfoot:1},hideModal:function hideModal(state){state.modal.show=false;state.modal.animation="";state.modal.message="";state.modal.title="";state.modal.cb=null;state.modal.cancel=null}};Vue.use(Vuex);Vue.config.debug=true;var store=new Vuex.Store({state:state,actions:actions,getters:getters,mutations:mutations,strict:false});return store});